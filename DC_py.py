# -*- coding: utf-8 -*-
"""DC.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BBra2gSgfm2b9OF2IqQZynD1f8pyb1ct

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
"""

# Commented out IPython magic to ensure Python compatibility.
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
# %matplotlib inline

df = pd.read_csv("Hotel Reservations.csv")

print("\n=== –ü–û–ò–°–ö –ê–ù–û–ú–ê–õ–ò–ô ===")
def quick_audit(df):
    report = {
        '–°—Ä–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è > 1 –≥–æ–¥': (df['lead_time'] > 365).sum(),
        '–î–µ—Ç–∏ –±–µ–∑ –≤–∑—Ä–æ—Å–ª—ã—Ö': ((df['no_of_adults'] == 0) & (df['no_of_children'] > 0)).sum(),
        '–ë—Ä–æ–Ω–∏ –±–µ–∑ –≥–æ—Å—Ç–µ–π': (df['no_of_adults'] + df['no_of_children'] == 0).sum(),
        '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–æ—á–∏': ((df['no_of_weekend_nights'] < 0) | (df['no_of_week_nights'] < 0)).sum()
    }
    return report

print("\nüîç –û—Ç—á—ë—Ç –æ–± –∞–Ω–æ–º–∞–ª–∏—è—Ö:")
for issue, count in quick_audit(df).items():
    print(f"‚Ä¢ {issue}: {count}")

"""# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ª–≥–∏—Ö lead_time –∏ —Å–º–µ—à–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø (–≤–∑—Ä–æ—Å–ª—ã–µ + –¥–µ—Ç–∏)"""

df = df[df['lead_time'] <= 365]
df = df[~((df['no_of_adults'] != 0) & (df['no_of_children'] > 0))]
df

"""# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤"""

print("\n=== –ü–†–û–í–ï–†–ö–ê –ò –û–ë–†–ê–ë–û–¢–ö–ê –ü–†–û–ü–£–°–ö–û–í ===")
missing = df.isnull().sum()
if missing.sum() == 0:
    print("‚úì –ü—Ä–æ–ø—É—Å–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç")
else:
    print("–ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏ –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö:")
    display(missing[missing > 0])

numeric_cols = ['lead_time', 'no_of_adults', 'no_of_children',
                   'no_of_weekend_nights', 'no_of_week_nights']
categorical_cols = ['type_of_meal_plan', 'room_type_reserved', 'market_segment_type']

"""# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π"""

print("\n=== –ü–†–û–í–ï–†–ö–ê –í–†–ï–ú–ï–ù–ù–´–• –ê–ù–û–ú–ê–õ–ò–ô ===")
current_year = pd.Timestamp.now().year
time_issues = {
    '–ë—Ä–æ–Ω–∏ –∏–∑ –±—É–¥—É—â–µ–≥–æ': (df['arrival_year'] > current_year).sum(),
}
price_issues = {
    '–¶–µ–Ω–∞ –Ω–æ–º–µ—Ä–∞ <= 0': (df['avg_price_per_room'] <= 0).sum(),
    '–¶–µ–Ω–∞ > 99% –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è': (df['avg_price_per_room'] > df['avg_price_per_room'].quantile(0.99)).sum()
}

print("\nüìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç:")
print("–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏:")
for issue, count in time_issues.items():
    print(f"‚Ä¢ {issue}: {count}")

print("\n–¶–µ–Ω–æ–≤—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏:")
for issue, count in price_issues.items():
    print(f"‚Ä¢ {issue}: {count}")

"""# –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –Ω–æ–º–µ—Ä–∞"""

df = df[df['avg_price_per_room'] > 0]
df = df[df['avg_price_per_room'] < df['avg_price_per_room'].quantile(0.99)]
df

"""# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–ø—É—Å–∫–∏"""

print("\n=== –û–ë–ó–û–† –î–ê–ù–ù–´–• ===")

print("\n–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:")
desc = df.describe(include='all')
pd.options.display.float_format = '{:.2f}'.format
with pd.option_context('display.max_columns', 10):
    display(desc)

print("\n–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:")
print(df.info())

print("\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:")
missing_values = df.isnull().sum()
print(missing_values.to_string())

print("\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å—Ç—Ä–æ–∫:", df.duplicated().sum())

cat_cols = ['type_of_meal_plan', 'room_type_reserved', 'market_segment_type', 'booking_status']
for col in cat_cols:
    print(f"\n–ö–æ–ª–æ–Ω–∫–∞: {col}")
    print(df[col].unique()[:5])

"""# –ê–Ω–∞–ª–∏–∑ —á–∏—Å–ª–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö"""

print("\n=== –ê–ù–ê–õ–ò–ó –ß–ò–°–õ–û–í–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–• ===")

print("\n–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π:")
plt.style.use('default')
axes = df.hist(
    figsize=(20, 15),
    bins=20,
    grid=False,
    color='#ab1636',
    edgecolor='white',
    linewidth=1,
    zorder=2
)
plt.suptitle("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤", y=1, fontsize=20, fontweight='bold')
for ax in axes.flatten():
    for spine in ['top', 'right']:
        ax.spines[spine].set_visible(False)
    ax.set_xlabel('–ó–Ω–∞—á–µ–Ω–∏—è', fontsize=12, labelpad=10)
    ax.set_ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', fontsize=12, labelpad=10)
    ax.set_title(ax.get_title(), fontsize=14, pad=10)
plt.tight_layout()
plt.show()

# –ü–æ—Å–ª–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º –¥–æ–±–∞–≤–ª—è–µ–º –±–æ–∫—Å–ø–ª–æ—Ç—ã —Å –≤—ã–±—Ä–æ—Å–∞–º–∏
print("\n–ê–Ω–∞–ª–∏–∑ –≤—ã–±—Ä–æ—Å–æ–≤:")
num_cols = ['lead_time', 'no_of_weekend_nights', 'no_of_week_nights', 'avg_price_per_room']
plt.figure(figsize=(12, 6))
sns.boxplot(
    data=df[num_cols],
    palette=['#ab1636']*len(num_cols),
    width=0.5,
    flierprops=dict(marker='o', markersize=5, markerfacecolor='#3a7ca5')  # –í—ã–±—Ä–æ—Å—ã —Å–∏–Ω–∏–º
)
plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Å –≤—ã–±—Ä–æ—Å–∞–º–∏)", fontsize=14, pad=15)
plt.xticks(rotation=45)
plt.show()

for col in num_cols:
    q1, q3 = df[col].quantile([0.25, 0.75])
    iqr = q3 - q1
    lower, upper = q1 - 1.5*iqr, q3 + 1.5*iqr
    outliers = df[(df[col] < lower) | (df[col] > upper)]
    print(f"\n{col}:")
    print(f"‚Ä¢ –ì—Ä–∞–Ω–∏—Ü—ã –≤—ã–±—Ä–æ—Å–æ–≤: [{lower:.1f}, {upper:.1f}]")
    print(f"‚Ä¢ –ù–∞–π–¥–µ–Ω–æ –≤—ã–±—Ä–æ—Å–æ–≤: {len(outliers)} ({len(outliers)/len(df)*100:.1f}%)")

print("\n–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:")
plt.figure(figsize=(10, 5))
sns.boxplot(
    x=df['lead_time'],
    color='#ab1636',
    width=0.3,
    linewidth=0.5,
    flierprops=dict(marker='o', markersize=3)
)
plt.title(
    "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∑–∞–µ–∑–¥–æ–º",
    fontsize=14,
    fontweight='bold',
    pad=15
)
plt.xlabel(
    "–î–Ω–µ–π",
    fontsize=12,
    labelpad=10
)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

print("\n–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:")
num_cols = ['no_of_adults', 'no_of_children', 'no_of_weekend_nights', 'no_of_week_nights', 'avg_price_per_room']
plt.figure(figsize=(15, 8))
sns.boxplot(
    data=df[num_cols],
    palette=['#ab1636']*len(num_cols),
    width=0.5,
    linewidth=0.7
)
plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤", fontsize=16, pad=15)
plt.xticks(rotation=45)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

print("\n=== –ê–ù–ê–õ–ò–ó –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–• ===")

plt.figure(figsize=(10, 4))
sns.countplot(
    x='type_of_meal_plan',
    data=df,
    order=df['type_of_meal_plan'].value_counts().index,
    color='#ab1636',
    edgecolor='white',
    linewidth=0.5
)
plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è", fontsize=14, fontweight='bold', pad=15)
plt.xlabel("–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è", fontsize=12, labelpad=10)
plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
plt.xticks(rotation=45)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

plt.figure(figsize=(10, 4))
sns.countplot(
    x='type_of_meal_plan',
    hue='booking_status',
    data=df,
    palette=['#ab1636', '#3a7ca5'],
    edgecolor='white',
    linewidth=0.5
)
plt.title("–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è vs –°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è", fontsize=14, fontweight='bold', pad=15)
plt.xlabel("–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è", fontsize=12, labelpad=10)
plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
plt.xticks(rotation=45)
plt.legend(title='–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏', title_fontsize=12, fontsize=11)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

print("\n–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –±—Ä–æ–Ω–∏ –ø–æ —Ç–∏–ø–∞–º –ø–∏—Ç–∞–Ω–∏—è:")
crosstab = pd.crosstab(
    index=df['type_of_meal_plan'],
    columns=df['booking_status'],
    normalize='index'
).round(2) * 100
display(crosstab.style
        .set_caption("–¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è (–≤ %)")
        .set_properties(**{'background-color': 'white', 'color': '#333333', 'border-color': 'white'})
        .format("{:.0f}%"))

# –í –±–ª–æ–∫–µ "–ê–ù–ê–õ–ò–ó –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–•"
print("\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–æ–º–∞–ª–∏–π –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö:")
for col in ['type_of_meal_plan', 'room_type_reserved', 'market_segment_type']:
    print(f"\n‚Ä¢ {col}:")
    display(df[col].value_counts(dropna=False).to_frame().style.set_caption(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ {col}"))

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:
# - **–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è:** Meal Plan 1 –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ 60% –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.
# - **–ö–∞–Ω–∞–ª—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:** 72% —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-–∫–∞–Ω–∞–ª—ã.
# - **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è:** –°—Ä–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (`lead_time`) –∏ –æ—Ç–º–µ–Ω—ã (+0.45).

print("\n=== –ê–ù–ê–õ–ò–ó –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–• ===")

plt.figure(figsize=(8, 8))
df['room_type_reserved'].value_counts().plot.pie(
    autopct='%1.1f%%',
    colors=['#ab1636', '#d92b4b', '#f26a8d', '#ff9bb3', '#c5e0f9', '#8cb9e8', '#5a8fd3'],
    wedgeprops={'edgecolor': 'white', 'linewidth': 0.5},
    textprops={'fontsize': 12}
)
plt.title("–î–æ–ª—è —Ç–∏–ø–æ–≤ –Ω–æ–º–µ—Ä–æ–≤", fontsize=16, fontweight='bold', pad=20)
plt.ylabel('')
plt.tight_layout()
plt.show()

plt.figure(figsize=(12, 5))
sns.countplot(
    x='room_type_reserved',
    hue='booking_status',
    data=df,
    palette=['#ab1636', '#3a7ca5'],
    edgecolor='white',
    linewidth=0.5
)
plt.title("–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏ –ø–æ —Ç–∏–ø–∞–º –Ω–æ–º–µ—Ä–æ–≤", fontsize=16, fontweight='bold', pad=15)
plt.xlabel("–¢–∏–ø –Ω–æ–º–µ—Ä–∞", fontsize=12, labelpad=10)
plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
plt.xticks(rotation=45)
plt.legend(title='–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏', title_fontsize=12, fontsize=11)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

print("\n–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –±—Ä–æ–Ω–∏ –ø–æ —Ç–∏–ø–∞–º –Ω–æ–º–µ—Ä–æ–≤:")
crosstab = pd.crosstab(
    index=df['room_type_reserved'],
    columns=df['booking_status'],
    normalize='index'
).round(3) * 100

display(crosstab.style
        .set_caption("–¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (–≤ %)")
        .set_properties(**{'background-color': 'white', 'color': '#333333'})
        .format("{:.1f}%"))

print("\n=== –ê–ù–ê–õ–ò–ó –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–• ===")

plt.figure(figsize=(10, 4))
sns.countplot(
    x='market_segment_type',
    data=df,
    order=df['market_segment_type'].value_counts().index,
    color='#ab1636',
    edgecolor='white',
    linewidth=0.5
)
plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è", fontsize=14, fontweight='bold', pad=15)
plt.xlabel("–ö–∞–Ω–∞–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è", fontsize=12, labelpad=10)
plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
plt.xticks(rotation=45)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

plt.figure(figsize=(10, 4))
sns.countplot(
    x='market_segment_type',
    hue='booking_status',
    data=df,
    palette=['#ab1636', '#3a7ca5'],
    edgecolor='white',
    linewidth=0.5
)
plt.title("–ö–∞–Ω–∞–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è vs –°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏", fontsize=14, fontweight='bold', pad=15)
plt.xlabel("–ö–∞–Ω–∞–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è", fontsize=12, labelpad=10)
plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
plt.xticks(rotation=45)
plt.legend(title='–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏', title_fontsize=12, fontsize=11)
ax = plt.gca()
ax.set_facecolor('white')
for spine in ['top', 'right']:
    ax.spines[spine].set_visible(False)
plt.tight_layout()
plt.show()

print("\n–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ –∫–∞–Ω–∞–ª–∞–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:")
crosstab = pd.crosstab(
    index=df['market_segment_type'],
    columns=df['booking_status'],
    normalize='index'
).round(3) * 100

display(crosstab.style
        .set_caption("–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –±—Ä–æ–Ω–∏ –ø–æ –∫–∞–Ω–∞–ª–∞–º (–≤ %)")
        .set_properties(**{'background-color': 'white', 'color': '#333333'})
        .format("{:.1f}%")
        .highlight_max(axis=1, color='#f26a8d'))

print("\n=== –ê–ù–ê–õ–ò–ó –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–• ===")

print("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:")
print(df['booking_status'].value_counts())

plt.figure(figsize=(6, 6))
wedges, texts, autotexts = plt.pie(
    df['booking_status'].value_counts(),
    autopct='%1.1f%%',
    colors=['#3a7ca5', '#ab1636'],
    wedgeprops={'edgecolor': 'white', 'linewidth': 0.5},
    textprops={'fontsize': 12},
    startangle=90
)

plt.title("–î–æ–ª—è –æ—Ç–º–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –±—Ä–æ–Ω–∏", fontsize=14, fontweight='bold', pad=20)
plt.legend(
    wedges,
    ['–ù–µ –æ—Ç–º–µ–Ω–µ–Ω–æ', '–û—Ç–º–µ–Ω–µ–Ω–æ'],
    title='–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏',
    loc='upper right',
    bbox_to_anchor=(1, 0.9)
)
plt.tight_layout()
plt.show()
status_counts = df['booking_status'].value_counts(normalize=True).round(3) * 100
not_canceled = status_counts.iloc[0] if '–ù–µ –æ—Ç–º–µ–Ω–µ–Ω–æ' in status_counts else status_counts.iloc[1]
canceled = status_counts.iloc[1] if '–ù–µ –æ—Ç–º–µ–Ω–µ–Ω–æ' in status_counts else status_counts.iloc[0]
print(f"\n–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ:")
print(f"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ: {not_canceled}%")
print(f"–û—Ç–º–µ–Ω–µ–Ω–æ: {canceled}%")

print("\n=== –°–û–ó–î–ê–ù–ò–ï –ò –ê–ù–ê–õ–ò–ó –ù–û–í–´–• –ü–†–ò–ó–ù–ê–ö–û–í ===")

df['lenght_of_stay'] = df['no_of_week_nights'] + df['no_of_weekend_nights']
df['total_guests'] = df['no_of_adults'] + df['no_of_children']
df['type_of_accommodation'] = pd.cut(
    df['lenght_of_stay'],
    bins=[0, 2, 5, 100],
    labels=['short', 'middle', 'long']
)
df['group_type'] = pd.cut(
    df['total_guests'],
    bins=[0, 1, 2, 4, 100],
    labels=['one', 'pair', 'family', 'group']
)
df['booking_type'] = pd.cut(
    df['lead_time'],
    bins=[-1, 3, 30, 365],
    labels=['last moment', 'standard', 'early']
)
df['season'] = pd.cut(
    df['arrival_month'],
    bins=[0, 2, 5, 8, 11, 12],
    labels=['winter', 'spring', 'summer', 'autumn', 'winter'],
    ordered=False
)

print("\n=== –ü–†–û–í–ï–†–ö–ê –°–û–ó–î–ê–ù–ù–´–• –ü–†–ò–ó–ù–ê–ö–û–í ===")
new_cat_cols = ['type_of_accommodation', 'group_type', 'booking_type', 'season']

for col in new_cat_cols:
    print(f"\n‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–∞: {col} ‚îÄ‚îÄ")

    # 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    print("\n–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã):")
    value_counts = df[col].value_counts(dropna=False)
    value_percents = df[col].value_counts(dropna=False, normalize=True).mul(100).round(1)
    display(pd.DataFrame({
        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': value_counts,
        '–î–æ–ª—è (%)': value_percents
    }))

    # 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –Ω–∞ —Å—Ç–æ–ª–±—Ü–∞—Ö
    plt.figure(figsize=(10, 5))
    ax = df[col].value_counts().plot.bar(
        color='#ab1636',
        edgecolor='white',
        width=0.7
    )

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã
    for p in ax.patches:
        ax.annotate(f'{int(p.get_height())}\n({p.get_height()/len(df)*100:.1f}%)',
                   (p.get_x() + p.get_width() / 2., p.get_height()),
                   ha='center', va='center',
                   xytext=(0, 10),
                   textcoords='offset points',
                   fontsize=10)

    plt.title(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: {col}", fontsize=14, pad=15)
    plt.xlabel("")
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", fontsize=12)
    plt.xticks(rotation=45, fontsize=11)
    ax = plt.gca()
    ax.set_facecolor('white')
    for spine in ['top', 'right']:
        ax.spines[spine].set_visible(False)
    plt.tight_layout()
    plt.show()

# --- 2. –ê–Ω–∞–ª–∏–∑ –≤—ã–±—Ä–æ—Å–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –ß–ò–°–õ–û–í–´–• –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ---
num_new_cols = ['lenght_of_stay', 'total_guests']
for col in num_new_cols:
    print(f"\n‚îÄ‚îÄ –ê–Ω–∞–ª–∏–∑ –≤—ã–±—Ä–æ—Å–æ–≤: {col} ‚îÄ‚îÄ")

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∏—Å–ª–æ–≤–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É
    print("\n–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:")
    display(df[col].describe().to_frame('–ó–Ω–∞—á–µ–Ω–∏–µ'))

    plt.figure(figsize=(12, 5))

    # –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é
    plt.subplot(1, 2, 1)
    sns.histplot(
        x=df[col],
        color='#ab1636',
        kde=True,
        bins=30
    )
    plt.title(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ {col}", fontsize=12, pad=10)
    plt.xlabel(col, fontsize=10)
    plt.ylabel("–ß–∞—Å—Ç–æ—Ç–∞", fontsize=10)

    # Boxplot
    plt.subplot(1, 2, 2)
    sns.boxplot(
        x=df[col],
        color='#ab1636',
        width=0.4,
        flierprops=dict(marker='o', markersize=5, markerfacecolor='#3a7ca5')
    )
    plt.title(f"–í—ã–±—Ä–æ—Å—ã: {col}", fontsize=12, pad=10)
    plt.xlabel("")
    plt.xticks(fontsize=10)

    plt.tight_layout()
    plt.show()

    q1, q3 = df[col].quantile([0.25, 0.75])
    iqr = q3 - q1
    lower, upper = q1 - 1.5*iqr, q3 + 1.5*iqr
    outliers = df[(df[col] < lower) | (df[col] > upper)]
    print(f"‚Ä¢ –ì—Ä–∞–Ω–∏—Ü—ã –≤—ã–±—Ä–æ—Å–æ–≤: [{lower:.1f}, {upper:.1f}]")
    print(f"‚Ä¢ –ù–∞–π–¥–µ–Ω–æ –≤—ã–±—Ä–æ—Å–æ–≤: {len(outliers)} ({len(outliers)/len(df)*100:.1f}%)")

# --- 3. –ê–Ω–∞–ª–∏–∑ –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–• –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ---
new_cat_columns = ['booking_type', 'season', 'type_of_accommodation', 'group_type']

for col in new_cat_columns:
    print(f"\n{'='*50}\n–ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–∑–Ω–∞–∫–∞: {col}\n{'='*50}")

    # –¢–∞–±–ª–∏—Ü–∞ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
    print("\n–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã):")
    value_counts = df[col].value_counts(dropna=False)
    value_percents = df[col].value_counts(dropna=False, normalize=True).mul(100).round(1)
    display(pd.DataFrame({
        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': value_counts,
        '–î–æ–ª—è (%)': value_percents
    }))

    # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    plt.figure(figsize=(12, 6))
    ax = sns.countplot(
        x=col,
        data=df,
        order=df[col].value_counts().index,
        color='#ab1636',
        edgecolor='white',
        linewidth=0.5
    )

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã
    for p in ax.patches:
        ax.annotate(f'{int(p.get_height())}\n({p.get_height()/len(df)*100:.1f}%)',
                   (p.get_x() + p.get_width() / 2., p.get_height()),
                   ha='center', va='center',
                   xytext=(0, 10),
                   textcoords='offset points',
                   fontsize=10)

    plt.title(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: {col}", fontsize=14, fontweight='bold', pad=15)
    plt.xlabel(col, fontsize=12, labelpad=10)
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
    plt.xticks(rotation=45)
    ax = plt.gca()
    ax.set_facecolor('white')
    for spine in ['top', 'right']:
        ax.spines[spine].set_visible(False)
    plt.tight_layout()
    plt.show()

    # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–∏ —Å —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    plt.figure(figsize=(12, 6))
    ax = sns.countplot(
        x=col,
        hue='booking_status',
        data=df,
        palette=['#3a7ca5', '#ab1636'],
        edgecolor='white',
        linewidth=0.5
    )

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã
    for p in ax.patches:
        ax.annotate(f'{int(p.get_height())}',
                   (p.get_x() + p.get_width() / 2., p.get_height()),
                   ha='center', va='center',
                   xytext=(0, 5),
                   textcoords='offset points',
                   fontsize=9)

    plt.title(f"–í–ª–∏—è–Ω–∏–µ {col} –Ω–∞ –æ—Ç–º–µ–Ω—É –±—Ä–æ–Ω–∏", fontsize=14, fontweight='bold', pad=15)
    plt.xlabel(col, fontsize=12, labelpad=10)
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π", fontsize=12, labelpad=10)
    plt.xticks(rotation=45)
    plt.legend(title='–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏', title_fontsize=12, fontsize=11)
    ax = plt.gca()
    ax.set_facecolor('white')
    for spine in ['top', 'right']:
        ax.spines[spine].set_visible(False)
    plt.tight_layout()
    plt.show()

    # –¢–∞–±–ª–∏—Ü–∞ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–æ–≤
    print("\n–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:")
    crosstab = pd.crosstab(
        index=df[col],
        columns=df['booking_status'],
        normalize='index'
    ).round(3) * 100
    display(crosstab.style
            .set_caption(f"–°—Ç–∞—Ç—É—Å—ã –±—Ä–æ–Ω–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º {col} (–≤ %)")
            .set_properties(**{'background-color': 'white', 'color': '#333333'})
            .format("{:.1f}%"))

print("\n=== –ö–û–†–†–ï–õ–Ø–¶–ò–û–ù–ù–´–ô –ê–ù–ê–õ–ò–ó ===")

plt.figure(figsize=(12, 8))
corr = df.select_dtypes(include=['number']).corr()
mask = np.triu(np.ones_like(corr, dtype=bool))
heatmap = sns.heatmap(
    corr,
    mask=mask,
    annot=True,
    cmap=['#3a7ca5', 'white', '#ab1636'],
    center=0,
    fmt=".2f",
    linewidths=.5,
    cbar_kws={'label': '–£—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏'}
)

plt.title("–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤", fontsize=16, fontweight='bold', pad=20)
heatmap.set_xticklabels(
    heatmap.get_xticklabels(),
    rotation=45,
    horizontalalignment='right'
)
heatmap.set_yticklabels(
    heatmap.get_yticklabels(),
    rotation=0
)

plt.tight_layout()
plt.show()

df.to_csv('hotel_new_features.csv', index=False)

df

df_new = pd.read_csv("hotel_new_features.csv")
df_new.head()

df_new.columns

df_new = df_new.drop(['Booking_ID'], axis=1)
df_new = df_new.drop(['arrival_year'], axis=1)
df_new

import pandas as pd
import numpy as np
from sklearn.preprocessing import LabelEncoder, OneHotEncoder
from sklearn.feature_selection import VarianceThreshold, SelectKBest, f_classif, RFE
from sklearn.decomposition import PCA
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
X = df_new.drop('booking_status', axis=1)
y = df_new['booking_status']

# –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
le = LabelEncoder()
y_encoded = le.fit_transform(y)

df_new['booking_status'] = df_new['booking_status'].map({'Not_Canceled': 0, 'Canceled': 1})

df_new

## 1. –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

# –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
categorical_cols = X.select_dtypes(include=['object']).columns
numerical_cols = X.select_dtypes(exclude=['object']).columns

print("\n–ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:", categorical_cols.tolist())
print("–ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:", numerical_cols.tolist())

# –ú–µ—Ç–æ–¥ Label Encoding –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å –Ω–µ–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
label_cols = [col for col in categorical_cols if X[col].nunique() <= 5]
for col in label_cols:
    X[col] = LabelEncoder().fit_transform(X[col])

# –ú–µ—Ç–æ–¥ One-Hot Encoding –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
ohe_cols = [col for col in categorical_cols if X[col].nunique() > 5]
X = pd.get_dummies(X, columns=ohe_cols, drop_first=True)

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
X.fillna(X.mean(), inplace=True)

## 2. –û—Ç–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
### 2.1. –ú–µ—Ç–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏—Å–ø–µ—Ä—Å–∏–∏
selector = VarianceThreshold(threshold=0.01)  # –£–¥–∞–ª—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å –¥–∏—Å–ø–µ—Ä—Å–∏–µ–π < 0.01
X_variance = selector.fit_transform(X)
selected_features_variance = X.columns[selector.get_support()]
print(f"–ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–±–æ—Ä–∞ –ø–æ –¥–∏—Å–ø–µ—Ä—Å–∏–∏: {len(selected_features_variance)} –∏–∑ {X.shape[1]}: ", selected_features_variance)

##2.2 –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
numeric_features = df_new.select_dtypes(include=['int64', 'float64']).columns
correlation_matrix = df_new[numeric_features].corr()

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
plt.figure(figsize=(12, 8))
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', center=0)
plt.title('–ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤')
plt.show()

# –£–¥–∞–ª—è–µ–º —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
upper = correlation_matrix.where(np.triu(np.ones(correlation_matrix.shape), k=1).astype(bool))
to_drop = [column for column in upper.columns if any(upper[column] > 0.8)]
X_corr = X.drop(to_drop, axis=1)
print(f"–£–¥–∞–ª–µ–Ω–æ {len(to_drop)} —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: ", to_drop)

### 2.3. –ú–µ—Ç–æ–¥ –≥–ª–∞–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (PCA)
# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ PCA
pca = PCA()
X_pca = pca.fit_transform(X_scaled)

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä—è—Å–Ω–µ–Ω–Ω–æ–π –¥–∏—Å–ø–µ—Ä—Å–∏–∏
plt.figure(figsize=(10, 6))
plt.plot(np.cumsum(pca.explained_variance_ratio_))
plt.xlabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç')
plt.ylabel('–û–±—ä—è—Å–Ω–µ–Ω–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è')
plt.title('–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –æ–±—ä—è—Å–Ω–µ–Ω–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è')
plt.grid()
plt.show()

# –í—ã–±–∏—Ä–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ–±—ä—è—Å–Ω—è—é—â–∏—Ö 95% –¥–∏—Å–ø–µ—Ä—Å–∏–∏
n_components = np.argmax(np.cumsum(pca.explained_variance_ratio_) >= 0.95) + 1
print(f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: {n_components}")

### 2.4. –ú–µ—Ç–æ–¥—ã –æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (RFE)
# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ train/test
X_train, X_test, y_train, y_test = train_test_split(X, y_encoded, test_size=0.3, random_state=42)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º Random Forest –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–æ–¥–µ–ª–∏ –¥–ª—è RFE
model = RandomForestClassifier(random_state=42)
rfe = RFE(estimator=model, n_features_to_select=15, step=1)
rfe.fit(X_train, y_train)

# –û—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
selected_features_rfe = X.columns[rfe.support_]
print("–õ—É—á—à–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ RFE:", selected_features_rfe.tolist())

### 2.5. –ú–µ—Ç–æ–¥—ã –≤–ª–æ–∂–µ–Ω–∏—è (Feature Importance)
model.fit(X_train, y_train)
importances = model.feature_importances_

# –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏
indices = np.argsort(importances)[::-1]
features = X.columns

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
plt.figure(figsize=(12, 8))
plt.title("–í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (Random Forest)")
plt.bar(range(X.shape[1]), importances[indices], align="center")
plt.xticks(range(X.shape[1]), features[indices], rotation=90)
plt.xlim([-1, X.shape[1]])
plt.tight_layout()
plt.show()

# –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ø-15 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
top_n = 15
selected_features_importance = features[indices][:top_n]
print(f"–¢–æ–ø-{top_n} –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:", selected_features_importance.tolist())

## 3. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
# –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
final_features = set(selected_features_variance) & set(X_corr.columns) & set(selected_features_rfe) & set(selected_features_importance)
print(f"–ò—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: {len(final_features)}")
print("–ò—Ç–æ–≥–æ–≤—ã–µ –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:", final_features)

# –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç —Å –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
X_final = X[list(final_features)]

X_final['booking_status'] = y_encoded
Final_features = X_final
Final_features

Final_features.to_csv('Final_features.csv', index=False)

"""**Baseline - –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è**

–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. matplotlib –∏ seaborn –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –≥—Ä–∞—Ñ–∏–∫–æ–≤. pandas –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∞ numpy - –¥–ª—è —á–∏—Å–ª–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π. sklearn –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏, –≤—ã–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏, –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏) –∏ –æ—Ü–µ–Ω–∫–∏ –∏—Ö –∫–∞—á–µ—Å—Ç–≤–∞. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ imblearn, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –º–µ—Ç–æ–¥ SMOTE.
"""

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd
import numpy as np

from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report, precision_recall_curve, roc_curve, roc_auc_score, ConfusionMatrixDisplay, auc
from imblearn.over_sampling import SMOTE

"""–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ ‚ÄúFinal_features.csv‚Äù –≤ DataFrame, –ø–æ—Å–ª–µ —á–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ ‚Äúbooking_status‚Äù –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –≤ –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö."""

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
df = pd.read_csv('Final_features.csv')
print(df['booking_status'].value_counts())

"""–î–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ (X) –∏ —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (y), –∞ –∑–∞—Ç–µ–º —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏, –ø—Ä–∏ —ç—Ç–æ–º 30% –¥–∞–Ω–Ω—ã—Ö –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏, –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –∫–ª–∞—Å—Å–æ–≤ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –æ–±–µ–∏—Ö –≤—ã–±–æ—Ä–∫–∞—Ö."""

# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
X = df.drop('booking_status', axis=1)
y = df['booking_status']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=10, stratify=y)

"""–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ –æ–±—É—á–∞—é—â–µ–π –∏ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º StandardScaler, —á—Ç–æ–±—ã –ø—Ä–∏–≤–µ—Å—Ç–∏ –∏—Ö –∫ –µ–¥–∏–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±—É –∏ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è."""

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
scaler = StandardScaler()
scaled_X_train = scaler.fit_transform(X_train)
scaled_X_test = scaler.transform(X_test)

"""–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ —Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –≤ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ: —Å–Ω–∞—á–∞–ª–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤, –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–µ—Ç–æ–¥ SMOTE –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ –º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞, –∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–Ω–æ–≤–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SMOTE."""

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤
print("–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –≤ y_train –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏:", pd.Series(y_train).value_counts())
smote = SMOTE(random_state=42)
X_train_resampled, y_train_resampled = smote.fit_resample(scaled_X_train, y_train)
print("–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –≤ y_train –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:", pd.Series(y_train_resampled).value_counts())

"""–° –ø–æ–º–æ—â—å—é GridSearchCV –ø–æ–¥–±–∏—Ä–∞—é—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –º–æ–¥–µ–ª–∏ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –º–µ—Ç—Ä–∏–∫—É recall –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –∞ –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª—É—á—à–∞—è –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å."""

# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø–æ–¥–±–æ—Ä–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

# –ò—Å–ø–æ–ª—å–∑—É–µ–º GridSearchCV –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
param_grid = {'solver': ['liblinear', 'lbfgs', 'newton-cg', 'sag', 'saga']}
grid_model = GridSearchCV(LogisticRegression(random_state=42),
                           param_grid,
                           scoring='recall',
                           cv=5,
                           verbose=0)

grid_model.fit(X_train_resampled, y_train_resampled)

print("–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:", grid_model.best_params_)
best_log_model = grid_model.best_estimator_

"""–í —ç—Ç–æ–º –±–ª–æ–∫–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è accuracy, —Å—Ç—Ä–æ–∏—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫, –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –æ—Ç—á–µ—Ç –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π precision, recall, F1-score –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏."""

# –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏
y_pred = best_log_model.predict(scaled_X_test)

print("Accuracy:", accuracy_score(y_test, y_pred))
print("Confusion Matrix:\n", confusion_matrix(y_test, y_pred))

disp = ConfusionMatrixDisplay(confusion_matrix=confusion_matrix(y_test, y_pred),
                               display_labels=best_log_model.classes_)
disp.plot()
plt.show()


print("Classification Report:\n", classification_report(y_test, y_pred))

"""–ú–æ–¥–µ–ª—å –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø–æ–∫–∞–∑–∞–ª–∞ –æ–±—â—É—é —Ç–æ—á–Ω–æ—Å—Ç—å 76.80% –≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–∏ –∫–ª–∞—Å—Å–æ–≤. –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–∞ –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã—è–≤–∏–ª, —á—Ç–æ –º–æ–¥–µ–ª—å —Å –±–æ–ª—å—à–µ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å 1 (—Å–æ—Å—Ç–æ—è–≤—à–∏–µ—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è), —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 88%, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –≤—Å–µ —Å–ª—É—á–∞–∏ –∫–ª–∞—Å—Å–∞ 1 –±—ã–ª–∏ –≤–µ—Ä–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã (recall 77%). –ö–ª–∞—Å—Å 0 (–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è) –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –º–µ–Ω—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é (61%), —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å —á–∞—Å—Ç–æ –æ—à–∏–±–æ—á–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç —Å–æ—Å—Ç–æ—è–≤—à–∏–µ—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–º. –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —ç—Ç–æ, –ø–æ–∫–∞–∑—ã–≤–∞—è, —á—Ç–æ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤ –∫–ª–∞—Å—Å–∞ 1 (1546) –±—ã–ª–æ –æ—à–∏–±–æ—á–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ –∫–ª–∞—Å—Å 0.

–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ—Ä–æ–≥ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –≤–ª–∏—è–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏: —Å–Ω–∞—á–∞–ª–∞ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å—É 1, –∑–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ—Ä–æ–≥ (0.6), —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –ø–æ—Ä–æ–≥–∞, –∏, –Ω–∞–∫–æ–Ω–µ—Ü, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π, –≤—ã–≤–æ–¥—è—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏ accuracy, confusion matrix –∏ classification report.
"""

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
y_proba = best_log_model.predict_proba(scaled_X_test)[:, 1]  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∞—Å—Å–∞ 1

# –í—ã–±–æ—Ä –ø–æ—Ä–æ–≥–∞
threshold = 0.6

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ä–æ–≥–∞:
y_pred_threshold = (y_proba > threshold).astype(int)

# –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ —Å –Ω–æ–≤—ã–º –ø–æ—Ä–æ–≥–æ–º:
print("\n–û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ —Å –Ω–æ–≤—ã–º –ø–æ—Ä–æ–≥–æ–º ({}):".format(threshold))
print("Accuracy:", accuracy_score(y_test, y_pred_threshold))
print("Confusion Matrix:\n", confusion_matrix(y_test, y_pred_threshold))

disp_threshold = ConfusionMatrixDisplay(confusion_matrix=confusion_matrix(y_test, y_pred_threshold),
                               display_labels=best_log_model.classes_)
disp_threshold.plot()
plt.show()

print("Classification Report:\n", classification_report(y_test, y_pred_threshold))

"""–ò–∑–º–µ–Ω–∏–≤ –ø–æ—Ä–æ–≥ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –Ω–∞ 0.6, –æ–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Å–Ω–∏–∑–∏–ª–∞—Å—å –¥–æ 73.33%. –•–æ—Ç—è recall –¥–ª—è –∫–ª–∞—Å—Å–∞ 0 (–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è) –≤—ã—Ä–æ—Å, —á—Ç–æ –±—ã–ª–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º, precision –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —É–ø–∞–ª, —É–≤–µ–ª–∏—á–∏–≤ —á–∏—Å–ª–æ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π. Recall –¥–ª—è –∫–ª–∞—Å—Å–∞ 1 (—Å–æ—Å—Ç–æ—è–≤—à–∏–µ—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è) –ø—Ä–∏ —ç—Ç–æ–º —Å–Ω–∏–∑–∏–ª—Å—è. –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Å–æ—Å—Ç–æ—è–≤—à–∏–µ—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞–ª–∏ —á–∞—â–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ.

–ó–¥–µ—Å—å —Å—Ç—Ä–æ–∏—Ç—Å—è ROC-–∫—Ä–∏–≤–∞—è –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è AUC-ROC –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –æ—Ç–æ–±—Ä–∞–∂–∞—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –º–µ–∂–¥—É True Positive Rate –∏ False Positive Rate –∏ —á–∏—Å–ª–µ–Ω–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞—è –æ–±—â—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏.
"""

fpr_threshold, tpr_threshold, thresholds_roc_threshold = roc_curve(y_test, y_proba) #y_proba –Ω—É–∂–Ω–æ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è auc_roc
roc_auc_threshold = roc_auc_score(y_test, y_proba) #y_proba –Ω—É–∂–Ω–æ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è auc_roc


plt.plot(fpr_threshold, tpr_threshold, label=f'ROC AUC (Threshold = {threshold:.2f}) = {roc_auc_threshold:.2f}')
plt.plot([0, 1], [0, 1], 'k--')
plt.xlabel('False Positive Rate')
plt.ylabel('True Positive Rate')
plt.title('ROC Curve (Custom Threshold)')
plt.legend()
plt.show()

"""–í—ã—á–∏—Å–ª—è—é—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ –∫ –∫–ª–∞—Å—Å—É 1 (y_proba) –∏ –∫–ª–∞—Å—Å—É 0 (y_proba_class0), –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏."""

y_proba = best_log_model.predict_proba(scaled_X_test)[:, 1]  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∞—Å—Å–∞ 1
y_proba_class0 = 1-y_proba # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∞—Å—Å–∞ 0

"""–°—Ç—Ä–æ–∏—Ç—Å—è ROC-–∫—Ä–∏–≤–∞—è –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–ª–æ—â–∞–¥—å –ø–æ–¥ –Ω–µ–π (AUC) –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏, –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—è —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –º–µ–∂–¥—É True Positive Rate –∏ False Positive Rate –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è —á–∏—Å–ª–µ–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏."""

# ROC AUC
fpr, tpr, thresholds_roc = roc_curve(y_test, y_proba_class0, pos_label = 0)
roc_auc = roc_auc_score(y_test, y_proba)

plt.plot(fpr, tpr, label=f'ROC AUC = {roc_auc:.2f}')
plt.plot([0, 1], [0, 1], 'k--')
plt.xlabel('False Positive Rate')
plt.ylabel('True Positive Rate')
plt.title('ROC Curve')
plt.legend()
plt.show()

"""–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ –∫ –∫–∞–∂–¥–æ–º—É –∏–∑ –∫–ª–∞—Å—Å–æ–≤ (0 –∏ 1), –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π proba."""

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å–∞–º –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
proba = best_log_model.predict_proba(scaled_X_test)

"""–°–æ–∑–¥–∞–µ—Ç—Å—è DataFrame, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∞—Å—Å—É, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞."""

# –°–æ–∑–¥–∞–Ω–∏–µ DataFrame —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
proba_df = pd.DataFrame(proba, columns=['Probability_Class_0', 'Probability_Class_1'])
proba_df['Actual_Class'] = y_test.values
proba_df['Predicted_Class'] = y_pred_threshold

"""–í—ã–≤–æ–¥—è—Ç—Å—è –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ DataFrame, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å–∞–º, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏."""

# –í—ã–≤–æ–¥ DataFrame —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏
print("\n–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å–∞–º –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:")
print(proba_df.head())

"""–ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å—É 1) –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –ø–µ—Ä–≤–æ–≥–æ) –∏–∑ DataFrame, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π."""

# –ü—Ä–∏–º–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤–æ–≥–æ)
instance_index = 0
probability_of_booking = proba_df['Probability_Class_1'][instance_index]
print(f"\n–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ {instance_index}: {probability_of_booking:.4f}")

"""**–ú–æ–¥–µ–ª—å DecisionTree**

–ò–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ pandas –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, train_test_split, GridSearchCV –∏ StratifiedKFold –∏–∑ sklearn.model_selection –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏, DecisionTreeClassifier –∏–∑ sklearn.tree –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, accuracy_score, classification_report, confusion_matrix, recall_score –∏ make_scorer –∏–∑ sklearn.metrics –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏, SMOTE –∏–∑ imblearn.over_sampling –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤, StandardScaler –∏–∑ sklearn.preprocessing –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –∞ —Ç–∞–∫–∂–µ matplotlib.pyplot –∏ seaborn –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
"""

import pandas as pd
from sklearn.model_selection import train_test_split, GridSearchCV, StratifiedKFold
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix, recall_score, make_scorer
from imblearn.over_sampling import SMOTE
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

"""–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV-—Ñ–∞–π–ª–∞ ‚ÄúFinal_features1.csv‚Äù –≤ DataFrame pandas, –∞ –∑–∞—Ç–µ–º –≤—ã–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–∏ (X) –ø—É—Ç–µ–º —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–∞ ‚Äúbooking_status‚Äù –∏ —Ü–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (y) –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ ‚Äúbooking_status‚Äù."""

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
df = pd.read_csv('Final_features1.csv')
X = df.drop('booking_status', axis=1)
y = df['booking_status']

"""–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ –≤ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 70/30, –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (stratify=y) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –∫–ª–∞—Å—Å–æ–≤ –≤ –æ–±–µ–∏—Ö –≤—ã–±–æ—Ä–∫–∞—Ö, –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è random_state=77 –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""

# 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ (–∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 77, stratify=y)

"""–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—É—Ç–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º StandardScaler (–≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —Å—Ä–µ–¥–Ω–µ–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ), –∞ –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ –∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö."""

# 3. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

"""–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∞ SMOTE (Synthetic Minority Oversampling Technique) –∫ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –ø—É—Ç–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ –º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞, —É–≤–µ–ª–∏—á–∏–≤–∞—è –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å."""

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SMOTE –∫ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ *–ø–æ—Å–ª–µ* —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏
oversample = SMOTE(random_state=77)
over_X_train, over_y_train = oversample.fit_resample(X_train, y_train)

"""–ó–∞–¥–∞–µ—Ç—Å—è —Å–µ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (param_grid) –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, –≤–∫–ª—é—á–∞—é—â–∞—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫—Ä–∏—Ç–µ—Ä–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (criterion), –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã –¥–µ—Ä–µ–≤–∞ (max_depth), –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±–æ—Ä–æ–∫ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —É–∑–ª–∞ (min_samples_split) –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±–æ—Ä–æ–∫ –≤ –ª–∏—Å—Ç–µ (min_samples_leaf)."""

# 5. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞
param_grid = {
    'criterion': ['gini', 'entropy'],
    'max_depth': [None, 5, 10, 15, 20], # –¥–æ–±–∞–≤–∏–ª –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    'min_samples_split': [2, 5, 10, 15], # –¥–æ–±–∞–≤–∏–ª –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    'min_samples_leaf': [1, 2, 4, 6] # –¥–æ–±–∞–≤–∏–ª –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
   # 'class_weight': ['balanced', None]
}

"""–°–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π (DecisionTreeClassifier) —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º random_state=77 –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""

# 6. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ DecisionTreeClassifier
dt_model = DecisionTreeClassifier(random_state=77)

"""–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è GridSearchCV –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é —Å 5 —Ñ–æ–ª–¥–∞–º–∏ (StratifiedKFold), –º–µ—Ç—Ä–∏–∫—É recall –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞, –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è (verbose=2) –∏ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–¥—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (n_jobs=-1)."""

# 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GridSearchCV
cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=77)
recall_scorer = make_scorer(recall_score)
grid_search = GridSearchCV(estimator=dt_model,
                           param_grid=param_grid,
                           cv=cv,
                           scoring=recall_scorer,
                           verbose=2,
                           n_jobs=-1)

"""–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV –Ω–∞ –ø–µ—Ä–µ–¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ (over_X_train, over_y_train) –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∏–ª—É—á—à–µ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∑–∞–¥–∞–Ω–Ω—ã—Ö –≤ param_grid."""

# 8. –û–±—É—á–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV
grid_search.fit(over_X_train, over_y_train)

"""–í—ã–≤–æ–¥—è—Ç—Å—è –Ω–∞–∏–ª—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV."""

# 9. –í—ã–≤–æ–¥ –ª—É—á—à–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
print("–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:", grid_search.best_params_)

"""–ò–∑ –æ–±—ä–µ–∫—Ç–∞ grid_search –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, –æ–±—É—á–µ–Ω–Ω–∞—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏."""

# 10. –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
best_dt_model = grid_search.best_estimator_

"""–ò—Å–ø–æ–ª—å–∑—É—è –ª—É—á—à—É—é –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ."""

# 11. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ
y_pred = best_dt_model.predict(X_test)

"""–û—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ, –≤—ã–≤–æ–¥—è—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ (accuracy) –∏ –æ—Ç—á–µ—Ç –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π precision, recall, F1-score –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞."""

# 12. –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫
print("–¢–æ—á–Ω–æ—Å—Ç—å (Accuracy):", accuracy_score(y_test, y_pred))
print("–û—Ç—á–µ—Ç –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:\n", classification_report(y_test, y_pred))

"""–í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞."""

# 13. –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ (Confusion Matrix)
conf_matrix = confusion_matrix(y_test, y_pred)
print("–ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫:\n", conf_matrix)

"""–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã (heatmap) –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–≥–ª—è–¥–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–¥–µ –ø–æ –æ—Å—è–º –æ—Ç–ª–æ–∂–µ–Ω—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã."""

# 14. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã –æ—à–∏–±–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
plt.figure(figsize=(8, 6))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues',
            xticklabels=['Class 0', 'Class 1'],
            yticklabels=['Class 0', 'Class 1'])
plt.xlabel('Predicted Label')
plt.ylabel('True Label')
plt.title('Confusion Matrix')
plt.show()

"""–ú–æ–¥–µ–ª—å –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, –æ–±—É—á–µ–Ω–Ω–∞—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ –º–µ—Ç—Ä–∏–∫–µ recall, –ø–æ–∫–∞–∑–∞–ª–∞ –æ–±—â—É—é —Ç–æ—á–Ω–æ—Å—Ç—å 86.74%. –õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: entropy criterion, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ 20, –º–∏–Ω–∏–º—É–º 1 –æ–±—Ä–∞–∑–µ—Ü –≤ –ª–∏—Å—Ç–µ –∏ –º–∏–Ω–∏–º—É–º 2 –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è. –ú–æ–¥–µ–ª—å —Ö–æ—Ä–æ—à–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–≤—à–∏–µ—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–ª–∞—Å—Å 1), –Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ö—É–∂–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ (–∫–ª–∞—Å—Å 0), —á—Ç–æ –≤–∏–¥–Ω–æ –∏–∑ –º–∞—Ç—Ä–∏—Ü—ã –æ—à–∏–±–æ–∫, –≥–¥–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–∂–Ω–æ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –¥–ª—è –∫–ª–∞—Å—Å–∞ 0 –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ. –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è —Å–ª–µ–¥—É–µ—Ç –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ—Ç–º–µ–Ω, –≤–æ–∑–º–æ–∂–Ω–æ, —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞ –∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ –∫–ª–∞—Å—Å–æ–≤.

**–ú–æ–¥–µ–ª—å - GradientBoostingClassifier**

–ö–æ–¥ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–∏, –∞–ª–≥–æ—Ä–∏—Ç–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞, –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏, –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é.
"""

import pandas as pd
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.ensemble import GradientBoostingClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix
from imblearn.over_sampling import SMOTE
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

"""–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV-—Ñ–∞–π–ª–∞ ‚ÄúFinal_features1.csv‚Äù –≤ DataFrame pandas, –∞ –∑–∞—Ç–µ–º –≤—ã–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–∏ (X) –ø—É—Ç–µ–º —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–∞ ‚Äúbooking_status‚Äù –∏ —Ü–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (y) –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ ‚Äúbooking_status‚Äù."""

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
df = pd.read_csv('Final_features.csv')
X = df.drop('booking_status', axis=1)
y = df['booking_status']

"""–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ –≤ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 70/30, –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (stratify=y) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –∫–ª–∞—Å—Å–æ–≤ –≤ –æ–±–µ–∏—Ö –≤—ã–±–æ—Ä–∫–∞—Ö, –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è random_state=77 –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""

# 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ (–∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 77, stratify=y)

"""–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—É—Ç–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º StandardScaler (–≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —Å—Ä–µ–¥–Ω–µ–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ), –∞ –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ –∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö."""

# 3. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

"""–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∞ SMOTE (Synthetic Minority Oversampling Technique) –∫ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –ø—É—Ç–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ –º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞, —É–≤–µ–ª–∏—á–∏–≤–∞—è –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å."""

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SMOTE –∫ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ
oversample = SMOTE(random_state=77)
over_X_train, over_y_train = oversample.fit_resample(X_train, y_train)

"""–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ç–∫—É –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (param_grid), –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏. –£–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–µ—Ä–µ–≤—å–µ–≤ –≤ –∞–Ω—Å–∞–º–±–ª–µ (n_estimators), —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è (learning_rate), –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω—ã –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ä–µ–≤–∞ (max_depth), –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—Ä–∞–∑—Ü–æ–≤ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É–∑–ª–∞ (min_samples_split) –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—Ä–∞–∑—Ü–æ–≤ –≤ –ª–∏—Å—Ç–æ–≤–æ–º —É–∑–ª–µ (min_samples_leaf). GridSearchCV –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤."""

# 5. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞
param_grid = {
    'n_estimators': [50, 100, 200, 300],  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤
    'learning_rate': [0.01, 0.05, 0.1, 0.2], # –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
    'max_depth': [3, 5, 7],                # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞
    'min_samples_split': [2, 5, 10],       # –ú–∏–Ω. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–∫ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —É–∑–ª–∞
    'min_samples_leaf': [1, 2, 4],         # –ú–∏–Ω. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–∫ –≤ –ª–∏—Å—Ç–æ–≤–æ–º —É–∑–ª–µ
}

"""–°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞ (GradientBoostingClassifier) —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–ª—É—á–∞–π–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (random_state=77) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""

# 6. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ GradientBoostingClassifier
gb_model = GradientBoostingClassifier(random_state=77)

"""–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º GridSearchCV –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞. –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∑–∞–¥–∞–Ω–Ω—ã—Ö –≤ param_grid, –∏—Å–ø–æ–ª—å–∑—É—è 3-–∫—Ä–∞—Ç–Ω—É—é –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏. –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫–∏ recall. –ü–∞—Ä–∞–º–µ—Ç—Ä verbose=2 –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–∏—Å–∫–∞, –∞ n_jobs=-1 —É–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–¥—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π."""

# 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GridSearchCV
grid_search = GridSearchCV(estimator=gb_model,
                           param_grid=param_grid,
                           cv=3,               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ–ª–¥–æ–≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏
                           scoring='recall',      # –ú–µ—Ç—Ä–∏–∫–∞ –æ—Ü–µ–Ω–∫–∏ (recall)
                           verbose=2,           # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
                           n_jobs=-1)          # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–¥—Ä–∞

"""–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV. –ë–µ—Ä–µ–º –º–æ–¥–µ–ª—å gb_model –∏ —Å–µ—Ç–∫—É –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ param_grid, –∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—É—á–∞–µ—Ç –∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (over_X_train, over_y_train), —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–º SMOTE (–ø–µ—Ä–µ–¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—Å–æ–≤). GridSearchCV –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–∞–∏–ª—É—á—à—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—é—â—É—é –º–µ—Ç—Ä–∏–∫—É recall –Ω–∞ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏."""

# 8. –û–±—É—á–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV
grid_search.fit(over_X_train, over_y_train)

"""–í—ã–≤–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –Ω–∞–∏–ª—É—á—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ GridSearchCV –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è. –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–ª–∏ –Ω–∞–∏–ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏, –∏–∑–º–µ—Ä–µ–Ω–Ω—É—é –º–µ—Ç—Ä–∏–∫–æ–π recall."""

# 9. –í—ã–≤–æ–¥ –ª—É—á—à–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
print("–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:", grid_search.best_params_)

"""–ò–∑–≤–ª–µ–∫–∞–µ–º –ª—É—á—à—É—é –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –∏–∑ –æ–±—ä–µ–∫—Ç–∞ GridSearchCV. best_estimator_ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–æ–¥–µ–ª—å GradientBoostingClassifier, –æ–±—É—á–µ–Ω–Ω—É—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–±–æ—Ä–∞. –¢–µ–ø–µ—Ä—å best_gb_model –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""

# 10. –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
best_gb_model = grid_search.best_estimator_

"""–ò—Å–ø–æ–ª—å–∑—É–µ–º –ª—É—á—à—É—é –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å (best_gb_model), —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (y_pred) –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ –¥–∞–Ω–Ω—ã—Ö (X_test). –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –≤–µ–∫—Ç–æ—Ä y_pred, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ."""

# 11. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ
y_pred = best_gb_model.predict(X_test)

"""–í—ã–≤–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –º–µ—Ç—Ä–∏–∫–∏, –æ—Ü–µ–Ω–∏–≤–∞—é—â–∏–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ.

–¢–æ—á–Ω–æ—Å—Ç—å (Accuracy): –û–±—â–∞—è –¥–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤.
–û—Ç—á–µ—Ç –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Classification Report): –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π precision, recall, F1-score –∏ support –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞. –≠—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –º–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å.
"""

# 12. –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫
print("–¢–æ—á–Ω–æ—Å—Ç—å (Accuracy):", accuracy_score(y_test, y_pred))
print("–û—Ç—á–µ—Ç –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:\n", classification_report(y_test, y_pred))

"""–°–æ–∑–¥–∞–µ–º –∏ –≤—ã–≤–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –º–∞—Ç—Ä–∏—Ü—É –æ—à–∏–±–æ–∫ (confusion_matrix), –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞. –°—Ç—Ä–æ–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –∫–ª–∞—Å—Å–∞–º, –∞ —Å—Ç–æ–ª–±—Ü—ã ‚Äì –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º –∫–ª–∞—Å—Å–∞–º. –ê–Ω–∞–ª–∏–∑ –º–∞—Ç—Ä–∏—Ü—ã –æ—à–∏–±–æ–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å, –∫–∞–∫–∏–µ –∫–ª–∞—Å—Å—ã –º–æ–¥–µ–ª—å –ø—É—Ç–∞–µ—Ç —á–∞—â–µ –≤—Å–µ–≥–æ –∏ –∫–∞–∫–∏–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç (–ª–æ–∂–Ω–æ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏–ª–∏ –ª–æ–∂–Ω–æ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)."""

# 13. –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ (Confusion Matrix)
conf_matrix = confusion_matrix(y_test, y_pred)
print("–ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫:\n", conf_matrix)

"""–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã (heatmap) –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–≥–ª—è–¥–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–¥–µ –ø–æ –æ—Å—è–º –æ—Ç–ª–æ–∂–µ–Ω—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã."""

# 14. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã –æ—à–∏–±–æ–∫
plt.figure(figsize=(8, 6))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues',
            xticklabels=['Class 0', 'Class 1'],
            yticklabels=['Class 0', 'Class 1'])
plt.xlabel('Predicted Label')
plt.ylabel('True Label')
plt.title('Confusion Matrix')
plt.show()

"""–ú–æ–¥–µ–ª—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ö–æ—Ä–æ—à—É—é –æ–±—â—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—è –æ–±—ä–µ–∫—Ç—ã –∫–ª–∞—Å—Å–∞ 1. –û–¥–Ω–∞–∫–æ, –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –∫–ª–∞—Å—Å–∞ 0.

**–ú–æ–¥–µ–ª—å - Random Forest**

–ö–æ–¥ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–∏, –∞–ª–≥–æ—Ä–∏—Ç–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞, –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏, –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é.
"""

import pandas as pd
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix
from imblearn.over_sampling import SMOTE
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

"""–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV-—Ñ–∞–π–ª–∞ ‚ÄúFinal_features1.csv‚Äù –≤ DataFrame pandas, –∞ –∑–∞—Ç–µ–º –≤—ã–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–∏ (X) –ø—É—Ç–µ–º —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–∞ ‚Äúbooking_status‚Äù –∏ —Ü–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (y) –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ ‚Äúbooking_status‚Äù."""

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
df = pd.read_csv('Final_features1.csv')
X = df.drop('booking_status', axis=1)
y = df['booking_status']

"""–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ –≤ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 70/30, –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (stratify=y) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –∫–ª–∞—Å—Å–æ–≤ –≤ –æ–±–µ–∏—Ö –≤—ã–±–æ—Ä–∫–∞—Ö, –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è random_state=77 –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""

# 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ (–∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 77, stratify=y)

"""–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—É—Ç–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º StandardScaler (–≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —Å—Ä–µ–¥–Ω–µ–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ), –∞ –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ –∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö."""

# 3. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

"""–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∞ SMOTE (Synthetic Minority Oversampling Technique) –∫ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –ø—É—Ç–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ –º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞, —É–≤–µ–ª–∏—á–∏–≤–∞—è –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å."""

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SMOTE –∫ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ
oversample = SMOTE(random_state=77)
over_X_train, over_y_train = oversample.fit_resample(X_train, y_train)

"""–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –º–µ–Ω—è—Ç—å—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–∏—Å–∫–∞ –Ω–∞–∏–ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏. –≠—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤ –≤ –∞–Ω—Å–∞–º–±–ª–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∫–∞–∂–¥–æ–≥–æ –¥–µ—Ä–µ–≤–∞, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —É–∑–ª–∞, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –ª–∏—Å—Ç–µ –∏ —Å–ø–æ—Å–æ–± —É—á–µ—Ç–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤."""

# 5. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞
param_grid = {
    'n_estimators': [50, 100, 200, 300],  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤
    'max_depth': [None, 5, 10, 15],      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞
    'min_samples_split': [2, 5, 10],   # –ú–∏–Ω. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–∫ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —É–∑–ª–∞
    'min_samples_leaf': [1, 2, 4],      # –ú–∏–Ω. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–∫ –≤ –ª–∏—Å—Ç–æ–≤–æ–º —É–∑–ª–µ
    'class_weight': ['balanced', 'balanced_subsample', None]  # –£—á–µ—Ç –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤
}

"""–°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏ ‚Äú–°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å‚Äù (RandomForestClassifier) —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º random_state=77. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –∫–æ–¥–∞ —Å —Ç–µ–º–∏ –∂–µ –¥–∞–Ω–Ω—ã–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –±—ã–ª–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏ (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å). RandomForestClassifier - —ç—Ç–æ –∞–Ω—Å–∞–º–±–ª–µ–≤—ã–π –º–µ—Ç–æ–¥ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤ —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è."""

# 6. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ RandomForestClassifier
rf_model = RandomForestClassifier(random_state=77)

"""–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è GridSearchCV. –û–Ω –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –Ω–∞–∏–ª—É—á—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞, –ø–µ—Ä–µ–±–∏—Ä–∞—è —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ param_grid. –û—Ü–µ–Ω–∫–∞ –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç—Ä–µ—Ö–∫—Ä–∞—Ç–Ω–æ–π –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ recall. –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —è–¥—Ä–∞, –∞ –Ω–∞ —ç–∫—Ä–∞–Ω –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö–æ–¥–µ –ø–æ–¥–±–æ—Ä–∞."""

# 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GridSearchCV
grid_search = GridSearchCV(estimator=rf_model,
                           param_grid=param_grid,
                           cv=3,               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ–ª–¥–æ–≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏
                           scoring='recall',      # –ú–µ—Ç—Ä–∏–∫–∞ –æ—Ü–µ–Ω–∫–∏
                           verbose=2,           # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
                           n_jobs=-1)          # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–¥—Ä–∞

"""–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞ –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥–±–æ—Ä –ª—É—á—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –µ—ë –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–º–æ–∂–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É—è –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞."""

# 8. –û–±—É—á–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GridSearchCV
grid_search.fit(over_X_train, over_y_train)

"""–í—ã–≤–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º GridSearchCV –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏. grid_search.best_params_ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞—Ä—å, –≥–¥–µ –∫–ª—é—á–∏ - –Ω–∞–∑–≤–∞–Ω–∏—è –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∞ –∑–Ω–∞—á–µ–Ω–∏—è - –ª—É—á—à–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è. –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞–ª–∏ –Ω–∞–∏–ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –≤—ã–±—Ä–∞–Ω–Ω—É—é –º–µ—Ç—Ä–∏–∫—É –æ—Ü–µ–Ω–∫–∏ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, recall). –≠—Ç–æ—Ç –≤—ã–≤–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –¥–ª—è –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö."""

# 9. –í—ã–≤–æ–¥ –ª—É—á—à–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
print("–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:", grid_search.best_params_)

"""–ò–∑ –æ–±—ä–µ–∫—Ç–∞ GridSearchCV –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ª—É—á—à–∞—è –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö."""

# 10. –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
best_rf_model = grid_search.best_estimator_

"""–ò—Å–ø–æ–ª—å–∑—É–µ–º –ª—É—á—à—É—é, —É–∂–µ –æ–±—É—á–µ–Ω–Ω—É—é –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞ (best_rf_model) –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è y_pred –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –µ—â–µ –Ω–µ –≤–∏–¥–µ–ª–∞ - —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ X_test. –≠—Ç–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""

# 11. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ
y_pred = best_rf_model.predict(X_test)

"""–í—ã–≤–æ–¥–∏—Ç—Å—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ. –í—ã–≤–æ–¥–∏—Ç—Å—è –æ–±—â–∞—è –¥–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (accuracy) –∏ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π precision, recall, F1-score –∏ support –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞."""

# 12. –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫
print("–¢–æ—á–Ω–æ—Å—Ç—å (Accuracy):", accuracy_score(y_test, y_pred))
print("–û—Ç—á–µ—Ç –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:\n", classification_report(y_test, y_pred))

"""
–°–æ–∑–¥–∞–µ—Ç—Å—è –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞. –°—Ç—Ä–æ–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –∫–ª–∞—Å—Å–∞–º, –∞ —Å—Ç–æ–ª–±—Ü—ã ‚Äì –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º."""

# 13. –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ (Confusion Matrix)
conf_matrix = confusion_matrix(y_test, y_pred)
print("–ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫:\n", conf_matrix)

"""–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã (heatmap) –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–≥–ª—è–¥–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–¥–µ –ø–æ –æ—Å—è–º –æ—Ç–ª–æ–∂–µ–Ω—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã."""

# 14. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã –æ—à–∏–±–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
plt.figure(figsize=(8, 6))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues',
            xticklabels=['Class 0', 'Class 1'],
            yticklabels=['Class 0', 'Class 1'])
plt.xlabel('Predicted Label')
plt.ylabel('True Label')
plt.title('Confusion Matrix')
plt.show()

"""–ò—Ç–æ–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å, –æ–±—É—á–µ–Ω–Ω–∞—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –¢–æ—á–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–∫–æ–ª–æ 90%, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ –≤—ã—Å–æ–∫–æ–π –¥–æ–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. –ú–æ–¥–µ–ª—å —Ö–æ—Ä–æ—à–æ –≤—ã—è–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –∫–ª–∞—Å—Å–∞ ‚Äú1‚Äù (recall 93%), –Ω–æ —á—É—Ç—å —Ö—É–∂–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∫–ª–∞—Å—Å–æ–º ‚Äú0‚Äù (recall 83%). –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å —á–∞—â–µ –æ—à–∏–±–æ—á–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç –æ–±—ä–µ–∫—Ç—ã –∫–ª–∞—Å—Å–∞ ‚Äú0‚Äù –∫ –∫–ª–∞—Å—Å—É ‚Äú1‚Äù. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—Å–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö."""